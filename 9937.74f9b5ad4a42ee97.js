(self.webpackChunktiti_ido=self.webpackChunktiti_ido||[]).push([[9937],{79937:(k,R,g)=>{"use strict";g.r(R),g.d(R,{default:()=>On});var I={};g.r(I),g.d(I,{decrypt:()=>kn,encrypt:()=>vn,generateKey:()=>Ye,verifyHmac:()=>Xe});var d=g(8239),p=g(61859);const y=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],F=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];var m=g(62630),A=g.n(m),Z=(g(16658),g(15343)),Y=g.n(Z);const C="utf8",f="0";function _(t){return new Uint8Array(t)}function h(t,e=!1){const n=t.toString("hex");return e?H(n):n}function U(t){return Y()(t)}function O(t,e=!1){return h(U(t),e)}function Ae(t){return function w(t){return t.toString(C)}(U(t))}function T(t){return _(function Me(t){return Buffer.from(E(t),"hex")}(t))}function z(t){return Buffer.from(t,C)}function Ne(t){return _(z(t))}function He(...t){let e=[];return t.forEach(n=>e=e.concat(Array.from(n))),new Uint8Array([...e])}function te(t,e=8,n=f){return function at(t,e,n=f){return function qe(t,e,n,r=f){const s=e-t.length;let c=t;if(s>0){const l=r.repeat(s);c=n?l+t:t+l}return c}(t,e,!0,n)}(t,function ot(t,e=8){const n=t%e;return n?(t-n)/e*e+e:t}(t.length,e),n)}function E(t){return t.replace(/^0x/,"")}function H(t){return t.startsWith("0x")?t:`0x${t}`}function Le(t){return(t=te(t=E(t),2))&&(t=H(t)),t}function ne(t){return U(new Uint8Array(t))}function _t(t){return _(t).buffer}function je(t,e){const n=E(Le(new(A())(t).toString(16)));return e?n:H(n)}var bt=g(37109);function D(t){return Le(t)}const wt=g(22339).payloadId;function re(){return((e,n)=>{for(n=e="";e++<36;n+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return n})()}function Pe(t,e){return function Ce(t,e){return!("string"!=typeof t||!t.match(/^0x[0-9A-Fa-f]*$/)||e&&t.length!==2+2*e)}(t,e)}function q(t){return typeof t.result<"u"}function J(t){return typeof t.error<"u"}function Ge(t){return typeof t.event<"u"}function Fe(t){return!function Et(t){return!(t&&t.length)}(t)&&!Pe(t[0])&&(t[0]=function yt(t,e){return function nt(t,e=!1){return h(z(t),e)}(t,!e)}(t[0])),t}function se(t){if(typeof t.type<"u"&&"0"!==t.type)return t;if(typeof t.from>"u"||!(t=>!(!t||"0x"!==t.toLowerCase().substring(0,2)||!/^(0x)?[0-9a-f]{40}$/i.test(t)||!/^(0x)?[0-9a-f]{40}$/.test(t)&&!/^(0x)?[0-9A-F]{40}$/.test(t)&&t!==function Ot(t){t=E(t.toLowerCase());const e=E((0,bt.keccak_256)(function gt(t){return z(t)}(t)));let n="";for(let r=0;r<t.length;r++)parseInt(e[r],16)>7?n+=t[r].toUpperCase():n+=t[r];return H(n)}(t)))(t.from))throw new Error("Transaction object must include a valid 'from' value.");function e(s){let c=s;return("number"==typeof s||"string"==typeof s&&!function Tt(t){return""===t||"string"==typeof t&&""===t.trim()}(s))&&(Pe(s)?"string"==typeof s&&(c=D(s)):c=je(s)),"string"==typeof c&&(c=function Rt(t){return function ut(t){const e=t.startsWith("0x");return t=(t=E(t)).startsWith(f)?t.substring(1):t,e?H(t):t}(H(t))}(c)),c}const n={from:D(t.from),to:typeof t.to>"u"?void 0:D(t.to),gasPrice:typeof t.gasPrice>"u"?"":e(t.gasPrice),gas:typeof t.gas>"u"?typeof t.gasLimit>"u"?"":e(t.gasLimit):e(t.gas),value:typeof t.value>"u"?"":e(t.value),nonce:typeof t.nonce>"u"?"":e(t.nonce),data:typeof t.data>"u"?"":D(t.data)||"0x"},r=["gasPrice","gas","value","nonce"];return Object.keys(n).forEach(s=>{(typeof n[s]>"u"||"string"==typeof n[s]&&!n[s].trim().length)&&r.includes(s)&&delete n[s]}),n}var Ze=g(45703);function $e(t){return Ze.parse(t)}const jt=typeof global.WebSocket<"u"?global.WebSocket:g(80748),ie="Session currently connected",M="Session currently disconnected",We="JSON RPC response format is invalid",De="User close QRCode Modal",Je="abcdefghijklmnopqrstuvwxyz0123456789".split("").map(t=>`https://${t}.bridge.walletconnect.org`);var j=g(38572);function dn(t){return j.getBrowerCrypto().getRandomValues(new Uint8Array(t))}const v="AES-CBC",ce="HMAC";function mn(t){return t===v?{length:256,name:v}:{hash:{name:"SHA-256"},name:ce}}function bn(t){return t===v?["encrypt","decrypt"]:["sign","verify"]}function K(t){return ue.apply(this,arguments)}function ue(){return(ue=(0,d.Z)(function*(t,e=v){return j.getSubtleCrypto().importKey("raw",t,mn(e),!0,bn(e))})).apply(this,arguments)}function fe(){return(fe=(0,d.Z)(function*(t,e,n){const r=j.getSubtleCrypto(),s=yield K(e,v),c=yield r.encrypt({iv:t,name:v},s,n);return new Uint8Array(c)})).apply(this,arguments)}function he(){return(he=(0,d.Z)(function*(t,e,n){const r=j.getSubtleCrypto(),s=yield K(e,v),c=yield r.decrypt({iv:t,name:v},s,n);return new Uint8Array(c)})).apply(this,arguments)}function wn(t,e){return de.apply(this,arguments)}function de(){return(de=(0,d.Z)(function*(t,e){const n=j.getSubtleCrypto(),r=yield K(t,ce),s=yield n.sign({length:256,name:ce},r,e);return new Uint8Array(s)})).apply(this,arguments)}function In(t,e,n){return function Sn(t,e,n){return fe.apply(this,arguments)}(t,e,n)}function Tn(t,e,n){return function Rn(t,e,n){return he.apply(this,arguments)}(t,e,n)}function Ve(t,e){return ge.apply(this,arguments)}function ge(){return(ge=(0,d.Z)(function*(t,e){return yield wn(t,e)})).apply(this,arguments)}function Ye(t){return Ie.apply(this,arguments)}function Ie(){return(Ie=(0,d.Z)(function*(t){return _t(U(dn((t||256)/8)))})).apply(this,arguments)}function Xe(t,e){return Te.apply(this,arguments)}function Te(){return(Te=(0,d.Z)(function*(t,e){const n=T(t.data),r=T(t.iv),c=O(T(t.hmac),!1),l=He(n,r),S=O(yield Ve(e,l),!1);return E(c)===E(S)})).apply(this,arguments)}function vn(t,e,n){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,d.Z)(function*(t,e,n){const r=_(ne(e)),c=_(ne(n||(yield Ye(128)))),l=O(c,!1),S=Ne(JSON.stringify(t)),N=yield In(c,r,S),ze=O(N,!1),P=He(N,c);return{data:ze,hmac:O(yield Ve(r,P),!1),iv:l}})).apply(this,arguments)}function kn(t,e){return ve.apply(this,arguments)}function ve(){return(ve=(0,d.Z)(function*(t,e){const n=_(ne(e));if(!n)throw new Error("Missing key: required for decryption");if(!(yield Xe(t,n)))return null;const s=T(t.data),c=T(t.iv),b=Ae(yield Tn(c,n,s));let S;try{S=JSON.parse(b)}catch{return null}return S})).apply(this,arguments)}const On=class An extends class fn{constructor(e){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new class Xt{constructor(){this._eventEmitters=[]}subscribe(e){this._eventEmitters.push(e)}unsubscribe(e){this._eventEmitters=this._eventEmitters.filter(n=>n.event!==e)}trigger(e){let r,n=[];r=function vt(t){return typeof t.method<"u"}(e)?e.method:q(e)||J(e)?`response:${e.id}`:Ge(e)?e.event:"",r&&(n=this._eventEmitters.filter(s=>s.event===r)),(!n||!n.length)&&!function kt(t){return y.includes(t)||t.startsWith("wc_")}(r)&&!Ge(r)&&(n=this._eventEmitters.filter(s=>"call_request"===s.event)),n.forEach(s=>{if(J(e)){const c=new Error(e.error.message);s.callback(c,null)}else s.callback(null,e)})}},this._clientMeta=(0,p.getClientMeta)()||e.connectorOpts.clientMeta||null,this._cryptoLib=e.cryptoLib,this._sessionStorage=e.sessionStorage||new class en{constructor(e="walletconnect"){this.storageId=e}getSession(){let e=null;const n=(0,p.getLocal)(this.storageId);return n&&function Ht(t){return typeof t.bridge<"u"}(n)&&(e=n),e}setSession(e){return(0,p.setLocal)(this.storageId,e),e}removeSession(){(0,p.removeLocal)(this.storageId)}}(e.connectorOpts.storageId),this._qrcodeModal=e.connectorOpts.qrcodeModal,this._qrcodeModalOptions=e.connectorOpts.qrcodeModalOptions,this._signingMethods=[...F,...e.connectorOpts.signingMethods||[]],!e.connectorOpts.bridge&&!e.connectorOpts.uri&&!e.connectorOpts.session)throw new Error("Missing one of the required parameters: bridge / uri / session");e.connectorOpts.bridge&&(this.bridge=function un(t){return function an(t){return"walletconnect.org"===function sn(t){return function rn(t){let e=t.indexOf("//")>-1?t.split("/")[2]:t.split("/")[0];return e=e.split(":")[0],e=e.split("?")[0],e}(t).split(".").slice(-2).join(".")}(t)}(t)?function cn(){return Je[function on(){return Math.floor(Math.random()*Je.length)}()]}():t}(e.connectorOpts.bridge)),e.connectorOpts.uri&&(this.uri=e.connectorOpts.uri);const n=e.connectorOpts.session||this._getStorageSession();n&&(this.session=n),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=e.transport||new class Pt{constructor(e){if(this.opts=e,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=e.protocol,this._version=e.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=e.subscriptions||[],this._netMonitor=e.netMonitor||new class Lt{constructor(){this._eventEmitters=[],typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(e,n){this._eventEmitters.push({event:e,callback:n})}trigger(e){let n=[];e&&(n=this._eventEmitters.filter(r=>r.event===e)),n.forEach(r=>{r.callback()})}},!e.url||"string"!=typeof e.url)throw new Error("Missing or invalid WebSocket url");this._url=e.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(e){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(e){}get connecting(){return 0===this.readyState}set connected(e){}get connected(){return 1===this.readyState}set closing(e){}get closing(){return 2===this.readyState}set closed(e){}get closed(){return 3===this.readyState}open(){this._socketCreate()}close(){this._socketClose()}send(e,n,r){if(!n||"string"!=typeof n)throw new Error("Missing or invalid topic field");this._socketSend({topic:n,type:"pub",payload:e,silent:!!r})}subscribe(e){this._socketSend({topic:e,type:"sub",payload:"",silent:!0})}on(e,n){this._events.push({event:e,callback:n})}_socketCreate(){if(this._nextSocket)return;const e=function Gt(t,e,n){var r,s;const l=(t.startsWith("https")?t.replace("https","wss"):t.startsWith("http")?t.replace("http","ws"):t).split("?"),b=(0,p.isBrowser)()?{protocol:e,version:n,env:"browser",host:(null===(r=(0,p.getLocation)())||void 0===r?void 0:r.host)||""}:{protocol:e,version:n,env:(null===(s=(0,p.detectEnv)())||void 0===s?void 0:s.name)||""},S=function Ct(t,e){let n=$e(t);return n=Object.assign(Object.assign({},n),e),function Ut(t){return Ze.stringify(t)}(n)}(function xt(t){const e=-1!==t.indexOf("?")?t.indexOf("?"):void 0;return typeof e<"u"?t.substr(e):""}(l[1]||""),b);return l[0]+"?"+S}(this._url,this._protocol,this._version);if(this._nextSocket=new jt(e),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=n=>this._socketReceive(n),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=n=>this._socketError(n),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(e){const n=JSON.stringify(e);this._socket&&1===this._socket.readyState?this._socket.send(n):(this._setToQueue(e),this._socketCreate())}_socketReceive(e){var n=this;return(0,d.Z)(function*(){let r;try{r=JSON.parse(e.data)}catch{return}if(n._socketSend({topic:r.topic,type:"ack",payload:"",silent:!0}),n._socket&&1===n._socket.readyState){const s=n._events.filter(c=>"message"===c.event);s&&s.length&&s.forEach(c=>c.callback(r))}})()}_socketError(e){const n=this._events.filter(r=>"error"===r.event);n&&n.length&&n.forEach(r=>r.callback(e))}_queueSubscriptions(){this._subscriptions.forEach(n=>this._queue.push({topic:n,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(e){this._queue.push(e)}_pushQueue(){this._queue.forEach(n=>this._socketSend(n)),this._queue=[]}}({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),e.connectorOpts.uri&&this._subscribeToSessionRequest(),e.pushServerOpts&&this._registerPushServer(e.pushServerOpts)}set bridge(e){!e||(this._bridge=e)}get bridge(){return this._bridge}set key(e){if(!e)return;const n=function mt(t){return T(t).buffer}(e);this._key=n}get key(){return this._key?function pt(t,e){return O(new Uint8Array(t),!e)}(this._key,!0):""}set clientId(e){!e||(this._clientId=e)}get clientId(){let e=this._clientId;return e||(e=this._clientId=re()),this._clientId}set peerId(e){!e||(this._peerId=e)}get peerId(){return this._peerId}set clientMeta(e){}get clientMeta(){let e=this._clientMeta;return e||(e=this._clientMeta=(0,p.getClientMeta)()),e}set peerMeta(e){this._peerMeta=e}get peerMeta(){return this._peerMeta}set handshakeTopic(e){!e||(this._handshakeTopic=e)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(e){!e||(this._handshakeId=e)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(e){if(!e)return;const{handshakeTopic:n,bridge:r,key:s}=this._parseUri(e);this.handshakeTopic=n,this.bridge=r,this.key=s}set chainId(e){this._chainId=e}get chainId(){return this._chainId}set networkId(e){this._networkId=e}get networkId(){return this._networkId}set accounts(e){this._accounts=e}get accounts(){return this._accounts}set rpcUrl(e){this._rpcUrl=e}get rpcUrl(){return this._rpcUrl}set connected(e){}get connected(){return this._connected}set pending(e){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(e){!e||(this._connected=e.connected,this.accounts=e.accounts,this.chainId=e.chainId,this.bridge=e.bridge,this.key=e.key,this.clientId=e.clientId,this.clientMeta=e.clientMeta,this.peerId=e.peerId,this.peerMeta=e.peerMeta,this.handshakeId=e.handshakeId,this.handshakeTopic=e.handshakeTopic)}on(e,n){this._eventManager.subscribe({event:e,callback:n})}off(e){this._eventManager.unsubscribe(e)}createInstantRequest(e){var n=this;return(0,d.Z)(function*(){n._key=yield n._generateKey();const r=n._formatRequest({method:"wc_instantRequest",params:[{peerId:n.clientId,peerMeta:n.clientMeta,request:n._formatRequest(e)}]});n.handshakeId=r.id,n.handshakeTopic=re(),n._eventManager.trigger({event:"display_uri",params:[n.uri]}),n.on("modal_closed",()=>{throw new Error(De)});const s=()=>{n.killSession()};try{const c=yield n._sendCallRequest(r);return c&&s(),c}catch(c){throw s(),c}})()}connect(e){var n=this;return(0,d.Z)(function*(){if(!n._qrcodeModal)throw new Error("QRCode Modal not provided");return n.connected?{chainId:n.chainId,accounts:n.accounts}:(yield n.createSession(e),new Promise(function(){var r=(0,d.Z)(function*(s,c){n.on("modal_closed",()=>c(new Error(De))),n.on("connect",(l,b)=>{if(l)return c(l);s(b.params[0])})});return function(s,c){return r.apply(this,arguments)}}()))})()}createSession(e){var n=this;return(0,d.Z)(function*(){if(n._connected)throw new Error(ie);if(n.pending)return;n._key=yield n._generateKey();const r=n._formatRequest({method:"wc_sessionRequest",params:[{peerId:n.clientId,peerMeta:n.clientMeta,chainId:e&&e.chainId?e.chainId:null}]});n.handshakeId=r.id,n.handshakeTopic=re(),n._sendSessionRequest(r,"Session update rejected",{topic:n.handshakeTopic}),n._eventManager.trigger({event:"display_uri",params:[n.uri]})})()}approveSession(e){if(this._connected)throw new Error(ie);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"",this._sendResponse({id:this.handshakeId,jsonrpc:"2.0",result:{approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta}}),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(e){if(this._connected)throw new Error(ie);const n=e&&e.message?e.message:"Session Rejected",r=this._formatResponse({id:this.handshakeId,error:{message:n}});this._sendResponse(r),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:n}]}),this._removeStorageSession()}updateSession(e){if(!this._connected)throw new Error(M);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"";const r=this._formatRequest({method:"wc_sessionUpdate",params:[{approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl}]});this._sendSessionRequest(r,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}killSession(e){var n=this;return(0,d.Z)(function*(){const r=e?e.message:"Session Disconnected",c=n._formatRequest({method:"wc_sessionUpdate",params:[{approved:!1,chainId:null,networkId:null,accounts:null}]});yield n._sendRequest(c),n._handleSessionDisconnect(r)})()}sendTransaction(e){var n=this;return(0,d.Z)(function*(){if(!n._connected)throw new Error(M);const r=se(e),s=n._formatRequest({method:"eth_sendTransaction",params:[r]});return yield n._sendCallRequest(s)})()}signTransaction(e){var n=this;return(0,d.Z)(function*(){if(!n._connected)throw new Error(M);const r=se(e),s=n._formatRequest({method:"eth_signTransaction",params:[r]});return yield n._sendCallRequest(s)})()}signMessage(e){var n=this;return(0,d.Z)(function*(){if(!n._connected)throw new Error(M);const r=n._formatRequest({method:"eth_sign",params:e});return yield n._sendCallRequest(r)})()}signPersonalMessage(e){var n=this;return(0,d.Z)(function*(){if(!n._connected)throw new Error(M);e=Fe(e);const r=n._formatRequest({method:"personal_sign",params:e});return yield n._sendCallRequest(r)})()}signTypedData(e){var n=this;return(0,d.Z)(function*(){if(!n._connected)throw new Error(M);const r=n._formatRequest({method:"eth_signTypedData",params:e});return yield n._sendCallRequest(r)})()}updateChain(e){var n=this;return(0,d.Z)(function*(){if(!n._connected)throw new Error("Session currently disconnected");const r=n._formatRequest({method:"wallet_updateChain",params:[e]});return yield n._sendCallRequest(r)})()}unsafeSend(e,n){return this._sendRequest(e,n),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:n}]}),new Promise((r,s)=>{this._subscribeToResponse(e.id,(c,l)=>{if(c)s(c);else{if(!l)throw new Error("Missing JSON RPC response");r(l)}})})}sendCustomRequest(e,n){var r=this;return(0,d.Z)(function*(){if(!r._connected)throw new Error(M);switch(e.method){case"eth_accounts":return r.accounts;case"eth_chainId":return je(r.chainId);case"eth_sendTransaction":case"eth_signTransaction":e.params&&(e.params[0]=se(e.params[0]));break;case"personal_sign":e.params&&(e.params=Fe(e.params))}const s=r._formatRequest(e);return yield r._sendCallRequest(s,n)})()}approveRequest(e){if(!q(e))throw new Error('JSON-RPC success response must include "result" field');{const n=this._formatResponse(e);this._sendResponse(n)}}rejectRequest(e){if(!J(e))throw new Error('JSON-RPC error response must include "error" field');{const n=this._formatResponse(e);this._sendResponse(n)}}transportClose(){this._transport.close()}_sendRequest(e,n){var r=this;return(0,d.Z)(function*(){const s=r._formatRequest(e),c=yield r._encrypt(s),l=typeof n?.topic<"u"?n.topic:r.peerId,b=JSON.stringify(c),S=typeof n?.forcePushNotification<"u"?!n.forcePushNotification:function At(t){return!!t.method.startsWith("wc_")||!F.includes(t.method)}(s);r._transport.send(b,l,S)})()}_sendResponse(e){var n=this;return(0,d.Z)(function*(){const r=yield n._encrypt(e),s=n.peerId,c=JSON.stringify(r);n._transport.send(c,s,!0)})()}_sendSessionRequest(e,n,r){var s=this;return(0,d.Z)(function*(){s._sendRequest(e,r),s._subscribeToSessionResponse(e.id,n)})()}_sendCallRequest(e,n){return this._sendRequest(e,n),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:n}]}),this._subscribeToCallResponse(e.id)}_formatRequest(e){if(typeof e.method>"u")throw new Error('JSON RPC request must have valid "method" value');return{id:typeof e.id>"u"?wt():e.id,jsonrpc:"2.0",method:e.method,params:typeof e.params>"u"?[]:e.params}}_formatResponse(e){if(typeof e.id>"u")throw new Error('JSON RPC request must have valid "id" value');const n={id:e.id,jsonrpc:"2.0"};if(J(e)){const r=function Nt(t){const e=t.message||"Failed or Rejected Request";let n=-32e3;if(t&&!t.code)switch(e){case"Parse error":n=-32700;break;case"Invalid request":n=-32600;break;case"Method not found":n=-32601;break;case"Invalid params":n=-32602;break;case"Internal error":n=-32603;break;default:n=-32e3}const r={code:n,message:e};return t.data&&(r.data=t.data),r}(e.error);return Object.assign(Object.assign(Object.assign({},n),e),{error:r})}if(q(e))return Object.assign(Object.assign({},n),e);throw new Error(We)}_handleSessionDisconnect(e){const n=e||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),(0,p.removeLocal)(p.mobileLinkChoiceKey)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:n}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(e,n){n&&n.approved?(this._connected?(n.chainId&&(this.chainId=n.chainId),n.accounts&&(this.accounts=n.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,n.chainId&&(this.chainId=n.chainId),n.accounts&&(this.accounts=n.accounts),n.peerId&&!this.peerId&&(this.peerId=n.peerId),n.peerMeta&&!this.peerMeta&&(this.peerMeta=n.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(e)}_handleIncomingMessages(e){var n=this;return(0,d.Z)(function*(){if(![n.clientId,n.handshakeTopic].includes(e.topic))return;let s;try{s=JSON.parse(e.payload)}catch{return}const c=yield n._decrypt(s);c&&n._eventManager.trigger(c)})()}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(e,n){this.on(`response:${e}`,n)}_subscribeToSessionResponse(e,n){this._subscribeToResponse(e,(r,s)=>{r?this._handleSessionResponse(r.message):q(s)?this._handleSessionResponse(n,s.result):this._handleSessionResponse(s.error&&s.error.message?s.error.message:n)})}_subscribeToCallResponse(e){return new Promise((n,r)=>{this._subscribeToResponse(e,(s,c)=>{s?r(s):q(c)?n(c.result):r(c.error&&c.error.message?c.error:new Error(We))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(e,n)=>{const{request:r}=n.params[0];if((0,p.isMobile)()&&this._signingMethods.includes(r.method)){const s=(0,p.getLocal)(p.mobileLinkChoiceKey);s&&(window.location.href=s.href)}}),this.on("wc_sessionRequest",(e,n)=>{e&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:e.toString()}]}),this.handshakeId=n.id,this.peerId=n.params[0].peerId,this.peerMeta=n.params[0].peerMeta;const r=Object.assign(Object.assign({},n),{method:"session_request"});this._eventManager.trigger(r)}),this.on("wc_sessionUpdate",(e,n)=>{e&&this._handleSessionResponse(e.message),this._handleSessionResponse("Session disconnected",n.params[0])})}_initTransport(){this._transport.on("message",e=>this._handleIncomingMessages(e)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){return`${this.protocol}:${this.handshakeTopic}@${this.version}?bridge=${encodeURIComponent(this.bridge)}&key=${this.key}`}_parseUri(e){const n=function Bt(t){const e=t.indexOf(":"),n=-1!==t.indexOf("?")?t.indexOf("?"):void 0,r=t.substring(0,e),l=function c(P){const G=P.split("@");return{handshakeTopic:G[0],version:parseInt(G[1],10)}}(t.substring(e+1,n)),N=function S(P){const B=$e(P);return{key:B.key||"",bridge:B.bridge||""}}(typeof n<"u"?t.substr(n):"");return Object.assign(Object.assign({protocol:r},l),N)}(e);if(n.protocol===this.protocol){if(!n.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const r=n.handshakeTopic;if(!n.bridge)throw Error("Invalid or missing bridge url parameter value");const s=decodeURIComponent(n.bridge);if(!n.key)throw Error("Invalid or missing key parameter value");return{handshakeTopic:r,bridge:s,key:n.key}}throw new Error("URI format is invalid")}_generateKey(){var e=this;return(0,d.Z)(function*(){return e._cryptoLib?yield e._cryptoLib.generateKey():null})()}_encrypt(e){var n=this;return(0,d.Z)(function*(){const r=n._key;return n._cryptoLib&&r?yield n._cryptoLib.encrypt(e,r):null})()}_decrypt(e){var n=this;return(0,d.Z)(function*(){const r=n._key;return n._cryptoLib&&r?yield n._cryptoLib.decrypt(e,r):null})()}_getStorageSession(){let e=null;return this._sessionStorage&&(e=this._sessionStorage.getSession()),e}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(e){if(!e.url||"string"!=typeof e.url)throw Error("Invalid or missing pushServerOpts.url parameter value");if(!e.type||"string"!=typeof e.type)throw Error("Invalid or missing pushServerOpts.type parameter value");if(!e.token||"string"!=typeof e.token)throw Error("Invalid or missing pushServerOpts.token parameter value");const n={bridge:this.bridge,topic:this.clientId,type:e.type,token:e.token,peerName:"",language:e.language||""};this.on("connect",function(){var r=(0,d.Z)(function*(s,c){if(s)throw s;e.peerMeta&&(n.peerName=c.params[0].peerMeta.name);try{if(!(yield(yield fetch(`${e.url}/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})).json()).success)throw Error("Failed to register in Push Server")}catch{throw Error("Failed to register in Push Server")}});return function(s,c){return r.apply(this,arguments)}}())}}{constructor(e,n){super({cryptoLib:I,connectorOpts:e,pushServerOpts:n})}}},80748:k=>{"use strict";k.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},16658:k=>{k.exports=I,I.strict=d,I.loose=p;var R=Object.prototype.toString,g={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function I(y){return d(y)||p(y)}function d(y){return y instanceof Int8Array||y instanceof Int16Array||y instanceof Int32Array||y instanceof Uint8Array||y instanceof Uint8ClampedArray||y instanceof Uint16Array||y instanceof Uint32Array||y instanceof Float32Array||y instanceof Float64Array}function p(y){return g[R.call(y)]}},45703:(k,R,g)=>{"use strict";const I=g(82915),d=g(65361),p=g(95967);function Q(i){if("string"!=typeof i||1!==i.length)throw new TypeError("arrayFormatSeparator must be single character string")}function m(i,o){return o.encode?o.strict?I(i):encodeURIComponent(i):i}function A(i,o){return o.decode?d(i):i}function V(i){return Array.isArray(i)?i.sort():"object"==typeof i?V(Object.keys(i)).sort((o,u)=>Number(o)-Number(u)).map(o=>i[o]):i}function Z(i){const o=i.indexOf("#");return-1!==o&&(i=i.slice(0,o)),i}function x(i){const o=(i=Z(i)).indexOf("?");return-1===o?"":i.slice(o+1)}function C(i,o){return o.parseNumbers&&!Number.isNaN(Number(i))&&"string"==typeof i&&""!==i.trim()?i=Number(i):o.parseBooleans&&null!==i&&("true"===i.toLowerCase()||"false"===i.toLowerCase())&&(i="true"===i.toLowerCase()),i}function $(i,o){Q((o=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},o)).arrayFormatSeparator);const u=function ke(i){let o;switch(i.arrayFormat){case"index":return(u,a,f)=>{o=/\[(\d*)\]$/.exec(u),u=u.replace(/\[\d*\]$/,""),o?(void 0===f[u]&&(f[u]={}),f[u][o[1]]=a):f[u]=a};case"bracket":return(u,a,f)=>{o=/(\[\])$/.exec(u),f[u=u.replace(/\[\]$/,"")]=o?void 0!==f[u]?[].concat(f[u],a):[a]:a};case"comma":case"separator":return(u,a,f)=>{const h="string"==typeof a&&a.split("").indexOf(i.arrayFormatSeparator)>-1?a.split(i.arrayFormatSeparator).map(w=>A(w,i)):null===a?a:A(a,i);f[u]=h};default:return(u,a,f)=>{f[u]=void 0!==f[u]?[].concat(f[u],a):a}}}(o),a=Object.create(null);if("string"!=typeof i||!(i=i.trim().replace(/^[?#&]/,"")))return a;for(const f of i.split("&")){let[_,h]=p(o.decode?f.replace(/\+/g," "):f,"=");h=void 0===h?null:["comma","separator"].includes(o.arrayFormat)?h:A(h,o),u(A(_,o),h,a)}for(const f of Object.keys(a)){const _=a[f];if("object"==typeof _&&null!==_)for(const h of Object.keys(_))_[h]=C(_[h],o);else a[f]=C(_,o)}return!1===o.sort?a:(!0===o.sort?Object.keys(a).sort():Object.keys(a).sort(o.sort)).reduce((f,_)=>{const h=a[_];return f[_]=Boolean(h)&&"object"==typeof h&&!Array.isArray(h)?V(h):h,f},Object.create(null))}R.extract=x,R.parse=$,R.stringify=(i,o)=>{if(!i)return"";Q((o=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},o)).arrayFormatSeparator);const u=h=>o.skipNull&&(i=>null==i)(i[h])||o.skipEmptyString&&""===i[h],a=function F(i){switch(i.arrayFormat){case"index":return o=>(u,a)=>{const f=u.length;return void 0===a||i.skipNull&&null===a||i.skipEmptyString&&""===a?u:null===a?[...u,[m(o,i),"[",f,"]"].join("")]:[...u,[m(o,i),"[",m(f,i),"]=",m(a,i)].join("")]};case"bracket":return o=>(u,a)=>void 0===a||i.skipNull&&null===a||i.skipEmptyString&&""===a?u:null===a?[...u,[m(o,i),"[]"].join("")]:[...u,[m(o,i),"[]=",m(a,i)].join("")];case"comma":case"separator":return o=>(u,a)=>null==a||0===a.length?u:0===u.length?[[m(o,i),"=",m(a,i)].join("")]:[[u,m(a,i)].join(i.arrayFormatSeparator)];default:return o=>(u,a)=>void 0===a||i.skipNull&&null===a||i.skipEmptyString&&""===a?u:null===a?[...u,m(o,i)]:[...u,[m(o,i),"=",m(a,i)].join("")]}}(o),f={};for(const h of Object.keys(i))u(h)||(f[h]=i[h]);const _=Object.keys(f);return!1!==o.sort&&_.sort(o.sort),_.map(h=>{const w=i[h];return void 0===w?"":null===w?m(h,o):Array.isArray(w)?w.reduce(a(h),[]).join("&"):m(h,o)+"="+m(w,o)}).filter(h=>h.length>0).join("&")},R.parseUrl=(i,o)=>{o=Object.assign({decode:!0},o);const[u,a]=p(i,"#");return Object.assign({url:u.split("?")[0]||"",query:$(x(i),o)},o&&o.parseFragmentIdentifier&&a?{fragmentIdentifier:A(a,o)}:{})},R.stringifyUrl=(i,o)=>{o=Object.assign({encode:!0,strict:!0},o);const u=Z(i.url).split("?")[0]||"",a=R.extract(i.url),f=R.parse(a,{sort:!1}),_=Object.assign(f,i.query);let h=R.stringify(_,o);h&&(h=`?${h}`);let w=function Y(i){let o="";const u=i.indexOf("#");return-1!==u&&(o=i.slice(u)),o}(i.url);return i.fragmentIdentifier&&(w=`#${m(i.fragmentIdentifier,o)}`),`${u}${h}${w}`}},15343:(k,R,g)=>{var I=g(16658).strict;k.exports=function(p){if(I(p)){var y=Buffer.from(p.buffer);return p.byteLength!==p.buffer.byteLength&&(y=y.slice(p.byteOffset,p.byteOffset+p.byteLength)),y}return Buffer.from(p)}}}]);